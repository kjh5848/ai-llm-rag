# 파트 4. RAG 시스템 구축: 검색 증강 생성의 통합 아키텍처 레퍼런스

이 문서는 검색된 문서 조각과 LLM의 추론 능력을 결합하여 최종 응답을 생성하는 RAG 엔진의 오케스트레이션 원리를 다룹니다.

---

## 4.1 기술적 기원: 왜 생성 모델에 검색을 결합해야 하는가?
*   **LLM의 단일 추론의 한계**: 모델 단독으로는 "사실 관계"보다 "확률적으로 그럴싸한 답변"을 선호하여 거짓 정보를 생산할 위험이 큽니다.
*   **지식의 내재화 vs 외부 수급**: 수조 원이 드는 모델 재학습 대신, 필요한 지식을 즉석에서 '참고 서적'처럼 읽게 하는 것이 훨씬 경제적이고 정확하다는 결론에 도달했습니다.

## 4.2 아키텍처 설계: RAG 엔진 오케스트레이션의 핵심 정의
*   **Prompt Engineering (프롬프트 엔지니어링)**: 검색된 문서와 질문을 LLM이 이해하기 쉬운 구조로 배치하고, 행동 지침(시스템 메시지)을 부여하는 기술입니다.
*   **Retriever (검색기)**: 벡터 DB에서 관련 문서를 찾아오는 소프트웨어 모듈로, 단순 검색을 넘어 검색 결과의 순위를 조정하는 전략이 포함됩니다.
*   **Context Window Management**: LLM이 처리할 수 있는 입력 용량 내에 가장 핵심적인 정보만 선별하여 넣는 최적화 과정입니다.

## 4.3 작동 메커니즘: 시스템 내에서의 핵심 역할
*   **질문 변환 (Query Transformation)**: 사용자의 모호한 질문을 벡터 검색에 유리한 형태로 다시 작성합니다.
*   **지식 보강 (Augmentation)**: LLM의 기본 지식에 검색된 외부 지식을 결합하여 "주어진 정보만을 바탕으로 답하라"는 강력한 제약을 부여합니다.
*   **최종 응답 생성 (Generation)**: 추론형 모델(DeepSeek 등)이 제공된 근거를 바탕으로 논리적으로 완결된 답변을 작성합니다.

## 4.4 비즈니스 전략: RAG 시스템 도입의 실무적 근거
*   **할루시네이션 방지**: 답변의 모든 문장이 검색된 문서에 근거하도록 설계하여 기업용 서비스의 신뢰도를 확보합니다.
*   **출처 가시성 (Traceability)**: 사용자가 답변 하단에 표시된 원본 문서를 직접 클릭하여 내용을 재확인할 수 있는 투명성을 제공합니다.
*   **도메인 적응**: 일반 모델이 모르는 사내 특유의 용어나 문화를 즉시 서비스에 반영하기 위해 도입되었습니다.

## 4.5 트레이드오프: 통합 RAG 아키텍처의 강점과 제약 사항
*   **장점**
    *   **신뢰성**: 사실 기반의 답변을 보장합니다.
    *   **최신성**: 모델 학습 시점과 상관없이 최신 문서를 참조합니다.
*   **단점**
    *   **지연 시간 (Latency)**: 검색 과정과 LLM 생성 과정이 합쳐져 답변 생성 속도가 순수 모델보다 느려질 수 있습니다.
    *   **검색 품질 의존성**: 검색된 문서가 부족하면 LLM은 "모른다"고 답하거나 성능이 저하됩니다.

## 4.6 비교 우위: 순수 LLM 답변 방식과의 결정적 차이점
*   **순수 LLM vs RAG 엔진**:
    *   순수 LLM은 창의적 글쓰기에 강하지만 사실 관계에 약합니다. RAG 엔진은 창의성보다 '정교한 지식 전달'에 특화되어 있습니다.
*   **Basic RAG vs Advanced Rerank**:
    *   Basic은 단순히 벡터 거리가 가까운 것을 가져오지만, 본 레퍼런스에서 지향하는 방식은 검색된 결과를 다시 한번 정밀 채점하여 최상의 문맥을 선별합니다.

## 4.7 연관 생태계: RAG 엔진 구성 및 스트리밍 통합 스택
*   **Ollama (DeepSeek-R1)**: 고도로 훈련된 로컬 추론 엔진.
*   **LangChain Expression Language (LCEL)**: RAG 파이프라인(`검색 -> 보강 -> 생성`)을 선언적으로 구축하는 문법.
*   **Prompt Template**: 고정된 지시문과 가변적인 문맥/질문을 조합하는 도구.

---
**실습 연결 포인트**:
- 전체 RAG 엔진의 동작 흐름과 프롬프트 구성은 `01_basic_rag/tutorial_step3_rag.md`와 해당 파이썬 코드의 `PromptTemplate` 정의에서 확인할 수 있습니다.
