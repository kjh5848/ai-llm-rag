{% extends "base.html" %} 
{% block title %}ë°ì´í„° ì¸ì œìŠ¤íŠ¸ ê´€ë¦¬ - ë©”íƒ€ì½”ë”©{% endblock %} 
{% block page_title %}ë°ì´í„° ì¸ì œìŠ¤íŠ¸ ê´€ë¦¬{% endblock %} 
{% block page_subtitle %}ì‚¬ë‚´ ë¬¸ì„œ(PDF, Docx, XLSX)ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜í•˜ì—¬ ì§€ëŠ¥í˜• ë¹„ì„œì˜ ì§€ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.{% endblock %} 

{% block content %}
<div class="ingest-container">
    <!-- 1. ìŠ¤ë§ˆíŠ¸ ì—…ë¡œë“œ ì„¹ì…˜ -->
    <div class="card upload-card">
        <h3>ğŸ“‚ ì§€ëŠ¥í˜• ë¬¸ì„œ ì—…ë¡œë“œ</h3>
        <p>íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ì¶”ê°€í•˜ì„¸ìš”.</p>
        
        <form action="/admin/ingest/upload" method="post" enctype="multipart/form-data" class="upload-form">
            <div class="category-selector">
                <input type="radio" name="category" value="hr" id="cat-hr" checked>
                <label for="cat-hr">ğŸ‘¤ ì¸ì‚¬(HR)</label>
                
                <input type="radio" name="category" value="security" id="cat-sec">
                <label for="cat-sec">ğŸ›¡ï¸ ë³´ì•ˆ(Security)</label>
                
                <input type="radio" name="category" value="ops" id="cat-ops">
                <label for="cat-ops">âš™ï¸ ìš´ì˜(Ops)</label>
                
                <input type="radio" name="category" value="guide" id="cat-guide">
                <label for="cat-guide">ğŸ“– ê°€ì´ë“œ(Guide)</label>

                <input type="radio" name="category" value="general" id="cat-general">
                <label for="cat-general">ğŸ“‚ ì¼ë°˜(General)</label>
            </div>
            
            <div class="drop-zone" id="drop-zone">
                <div class="drop-zone-content">
                    <span class="upload-icon">ğŸ“¤</span>
                    <p>ì´ê³³ì— íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ <strong>í´ë¦­í•˜ì—¬ ì„ íƒ</strong>í•˜ì„¸ìš”.</p>
                    <input type="file" name="file" id="file-input" required hidden>
                    <div id="file-name-display" class="file-name-display"></div>
                </div>
            </div>
            
            <div class="upload-actions">
                <button type="submit" class="btn btn-primary">ì„œë²„ë¡œ ì—…ë¡œë“œ</button>
            </div>
        </form>
    </div>

    <!-- 2. ì¹´í…Œê³ ë¦¬ë³„ ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸ -->
    {% for cat_name, files in categories.items() %}
    <div class="card category-card">
        <div class="category-header">
            <h3>
                {% if cat_name == 'hr' %}ğŸ‘¤ ì¸ì‚¬(HR) Documents
                {% elif cat_name == 'security' %}ğŸ›¡ï¸ ë³´ì•ˆ(Security) Documents
                {% elif cat_name == 'ops' %}âš™ï¸ ìš´ì˜(Ops) Manuals
                {% elif cat_name == 'guide' %}ğŸ“– Guidebooks
                {% else %}ğŸ“‚ ì¼ë°˜ ë¬¸ì„œ{% endif %}
            </h3>
            <span class="file-count">{{ files|length }}ê°œ íŒŒì¼</span>
        </div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>íŒŒì¼ëª…</th>
                    <th>ìƒíƒœ</th>
                    <th>ì•¡ì…˜</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td><strong>{{ file.name }}</strong></td>
                    <td>
                        <span class="status-badge {% if file.status == 'Vector ì™„ë£Œ' %}status-active{% elif file.status == 'MD ì™„ë£Œ' %}status-pending{% else %}status-inactive{% endif %}">
                            {{ file.status }}
                        </span>
                    </td>
                    <td>
                        <div class="action-group">
                            {% if file.can_convert %}
                            <form action="/admin/ingest/convert" method="post">
                                <input type="hidden" name="file_path" value="{{ file.path }}" />
                                <button type="submit" class="btn btn-primary btn-sm">MD ë³€í™˜</button>
                            </form>
                            {% else %}
                            <button class="btn btn-sm btn-disabled" disabled>ë³€í™˜ ì™„ë£Œ</button>
                            {% endif %} 
                            
                            {% if file.can_embed %}
                            <form action="/admin/ingest/embed" method="post">
                                <input type="hidden" name="md_path" value="{{ file.md_path }}" />
                                <button type="submit" class="btn btn-success btn-sm">ë°±í„° ì„ë² ë”©</button>
                            </form>
                            {% else %}
                            <button class="btn btn-sm btn-disabled" disabled>ì„ë² ë”© ì™„ë£Œ</button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% if not files %}
                <tr>
                    <td colspan="3" class="empty-row">ì´ ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    {% endfor %}
</div>

<style>
    .ingest-container {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    /* ì—…ë¡œë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .upload-card {
        border: 2px dashed #e1e4e8;
        background: #fafbfc;
        padding: 30px;
    }

    .category-selector {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .category-selector input {
        display: none;
    }

    .category-selector label {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 20px;
        cursor: pointer;
        background: white;
        transition: all 0.2s;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .category-selector input:checked + label {
        background: #0366d6;
        color: white;
        border-color: #0366d6;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .drop-zone {
        border: 2px dashed #0366d6;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        background: white;
        cursor: pointer;
        transition: background 0.2s;
    }

    .drop-zone:hover {
        background: #f1f8ff;
    }

    .upload-icon {
        font-size: 2rem;
        display: block;
        margin-bottom: 10px;
    }

    .file-name-display {
        margin-top: 10px;
        font-weight: bold;
        color: #0366d6;
    }

    .upload-actions {
        margin-top: 20px;
        text-align: right;
    }

    /* ì¹´í…Œê³ ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .category-card {
        padding: 20px;
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }

    .file-count {
        font-size: 0.85rem;
        color: #666;
        background: #f0f0f0;
        padding: 2px 8px;
        border-radius: 10px;
    }

    .action-group {
        display: flex;
        gap: 8px;
    }

    .btn-disabled {
        background: #f0f0f0 !important;
        color: #999 !important;
        cursor: not-allowed;
    }

    .empty-row {
        text-align: center;
        padding: 30px !important;
        color: #999;
        font-style: italic;
    }

    .status-badge {
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    .status-active { background: #e6ffed; color: #22863a; }
    .status-pending { background: #fff5b1; color: #735c0f; }
    .status-inactive { background: #f6f8fa; color: #586069; }

    .btn-sm {
        padding: 4px 10px;
        font-size: 0.8rem;
    }
</style>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileNameDisplay = document.getElementById('file-name-display');

    dropZone.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = `ì„ íƒëœ íŒŒì¼: ${fileInput.files[0].name}`;
        }
    });

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.background = '#f1f8ff';
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.style.background = 'white';
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = 'white';
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            fileNameDisplay.textContent = `ì„ íƒëœ íŒŒì¼: ${e.dataTransfer.files[0].name}`;
        }
    });
</script>
{% endblock %}
